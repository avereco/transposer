function transpose(s){if(s){var e=$("#current-key").val();"auto"==e&&(e=null);for(var t,a,o,n,r,l,i=$("#new-key").val(),h=s.split(/(\s+)/g),d="",c="",p=0,f={},u=0;u<h.length;u++)h[u]in f?(d+=chordSpan(f[h[u]].symbol,f[h[u]].colour),c+=f[h[u]].symbol):chordPattern.test(h[u])?(l=XRegExp.exec(h[u],chordPattern),e||(e=l.chord),o=transposeNote(l.chord,e,i),n=void 0===l.suffix?"":l.suffix,r=void 0===l.bass?"":transposeNote(l.bass,e,i),a=o+n+r,t=colours[p++%colours.length],d+=chordSpan(a,t),c+=a,f[h[u]]={},f[h[u]].symbol=a,f[h[u]].colour=t):(d+=h[u],c+=h[u]);$("#replace-original").is(":checked")&&($("#chordarea").val(c),$("#current-key").val(i)),$("#output").html(d.replace(/(?:\r\n|\r|\n)/g,"<br />"))}}function chordSpan(s,e){return"<span class='chord' style='color: #"+e+"'>"+s+"</span>"}function transposeNote(s,e,t){if(!e in keys||!t in keys)throw"Specified keys do not exist!";var a=keys[t].index-keys[e].index,o=flats.indexOf(s);if(-1==o&&(o=sharps.indexOf(s)),-1==o)throw"Note ("+s+") does not exist.";return keys[t].flats>0?flats[(o+flats.length+a)%flats.length]:sharps[(o+sharps.length+a)%sharps.length]}var flats=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","Cb"],sharps=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],keys={C:{index:0,sharps:0,flats:0},Db:{index:1,sharps:0,flats:5},D:{index:2,sharps:2,flats:0},Eb:{index:3,sharps:0,flats:3},E:{index:4,sharps:4,flats:0},F:{index:5,sharps:0,flats:1},Gb:{index:6,sharps:0,flats:6},G:{index:7,sharps:1,flats:0},Ab:{index:8,sharps:0,flats:4},A:{index:9,sharps:3,flats:0},Bb:{index:10,sharps:0,flats:2},B:{index:11,sharps:5,flats:0}},chordPattern=XRegExp("^(?<chord>[A-G](#|b)?)(?<suffix>(\\(?(M|maj|major|m|min|minor|dim|sus|dom|aug|\\+|-|add)?\\d*\\)?)*)(\\/(?<bass>[A-G](#|b)?))?$"),colours=themes[0].colours;$(document).ready(function(){$("#print-button").click(function(){window.print()}),$("#transpose-button").click(function(){transpose($("#chordarea").val())}),$('[data-toggle="tooltip"]').tooltip();for(var s=0;s<themes.length;s++)$("#themes").append('<option value="'+s+'">'+themes[s].name+"</option>");$("#themes").change(function(){colours=themes[Number($("#themes option:selected").val())].colours})});