function transpose(s){if(s){var e=$("#current-key").val();"auto"==e&&(e=null);for(var t,n,o,a,r,i,l=$("#new-key").val(),h=s.split(/(\s+)/g),d="",p="",c=0,f={},u=0;u<h.length;u++)h[u]in f?(d+=chordSpan(f[h[u]].symbol,f[h[u]].colour),p+=f[h[u]].symbol):chordPattern.test(h[u])?(i=XRegExp.exec(h[u],chordPattern),e||(e=i.chord),o=transposeNote(i.chord,e,l),a=void 0===i.suffix?"":i.suffix,r=void 0===i.bass?"":transposeNote(i.bass,e,l),n=r?o+a+"/"+r:o+a,t=colours[c++%colours.length],d+=chordSpan(n,t),p+=n,f[h[u]]={},f[h[u]].symbol=n,f[h[u]].colour=t):(d+=h[u],p+=h[u]);$("#replace-original").is(":checked")&&($("#chordarea").val(p),$("#current-key").val(l)),$("#output").html(d.replace(/(?:\r\n|\r|\n)/g,"<br />"))}}function chordSpan(s,e){return"<span class='chord' style='color: #"+e+"'>"+s+"</span>"}function transposeNote(s,e,t){if(!e in keys||!t in keys)throw"Specified keys do not exist!";var n=keys[t].index-keys[e].index,o=flats.indexOf(s);if(-1==o&&(o=sharps.indexOf(s)),-1==o)throw"Note ("+s+") does not exist.";return keys[t].flats>0?flats[(o+flats.length+n)%flats.length]:sharps[(o+sharps.length+n)%sharps.length]}function transposeNoteSemitone(s,e){if(!e in keys)throw"Specified keys do not exist!";var t,o=(keys.indexOf(e)+n+keys.length)%keys.length;for(k in keys)if(k.index==o){t=k;break}return transposeNote(s,e,t)}var flats=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","Cb"],sharps=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],keys={C:{index:0,sharps:0,flats:0},Db:{index:1,sharps:0,flats:5},D:{index:2,sharps:2,flats:0},Eb:{index:3,sharps:0,flats:3},E:{index:4,sharps:4,flats:0},F:{index:5,sharps:0,flats:1},"F#":{index:6,sharps:6,flats:0},G:{index:7,sharps:1,flats:0},Ab:{index:8,sharps:0,flats:4},A:{index:9,sharps:3,flats:0},Bb:{index:10,sharps:0,flats:2},B:{index:11,sharps:5,flats:0}},chordPattern=XRegExp("^(?<chord>[A-G](#|b)?)(?<suffix>(\\(?(M|maj|major|m|min|minor|dim|sus|dom|aug|\\+|-|add)?\\d*\\)?)*)(\\/(?<bass>[A-G](#|b)?))?$"),colours=themes[0].colours;$(document).ready(function(){$("#print-button").click(function(){window.print()}),$("#transpose-button").click(function(){transpose($("#chordarea").val())}),$('[data-toggle="tooltip"]').tooltip();for(var s=0;s<themes.length;s++)$("#themes").append('<option value="'+s+'">'+themes[s].name+"</option>");$("#themes").change(function(){colours=themes[Number($("#themes option:selected").val())].colours})});