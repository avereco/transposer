function transpose(e){var t=$("#current-key").val();if(t=="auto"){t=null}var n=$("#new-key").val();var r=e.split(/(\s+)/g);var i="",s="";var o,u,a,f,l;var c=0;var h;var p={};for(var d=0;d<r.length;d++){if(r[d]in p){i+=chordSpan(p[r[d]]["symbol"],p[r[d]]["colour"]);s+=p[r[d]]["symbol"]}else if(chordPattern.test(r[d])){h=XRegExp.exec(r[d],chordPattern);if(!t)t=h.chord;a=transposeNote(h.chord,t,n);f=h.suffix===undefined?"":h.suffix;l=h.bass===undefined?"":transposeNote(h.bass,t,n);u=a+f+l;o=colours[c++%colours.length];i+=chordSpan(u,o);s+=u;p[r[d]]={};p[r[d]]["symbol"]=u;p[r[d]]["colour"]=o}else{i+=r[d];s+=r[d]}}$("#chordarea").val(s);$("#output").html(i.replace(/(?:\r\n|\r|\n)/g,"<br />"));$("#current-key").val(n)}function chordSpan(e,t){return"<span class='chord' style='color: #"+t+"'>"+e+"</span>"}function selectAll(){$("#chordarea").focus();$("#chordarea").select()}function transposeNote(e,t,n){if(!t in keys||!n in keys){throw"Specified keys do not exist!"}var r=keys[n]["index"]-keys[t]["index"];var i=flats.indexOf(e);if(i==-1)i=sharps.indexOf(e);if(i==-1)throw"Note ("+e+") does not exist.";if(keys[n]["flats"]>0){return flats[(i+flats.length+r)%flats.length]}else{return sharps[(i+sharps.length+r)%sharps.length]}}var themes=[{name:"default",colours:["337ab7"]},{name:"grey",colours:["212121"]},{name:"Google",colours:["F44336","E91E63","9C27B0","2196F3","FF9800","4CAF50"]},{name:"winter love",colours:["250E38","5F1D41","AD2345","E22647"]},{name:"espresso bar",colours:["CE5861","A75C69","875E6A","77646D","9F8887"]}];var flats=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","Cb"];var sharps=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];var keys={C:{index:0,sharps:0,flats:0},Db:{index:1,sharps:0,flats:5},D:{index:2,sharps:2,flats:0},Eb:{index:3,sharps:0,flats:3},E:{index:4,sharps:4,flats:0},F:{index:5,sharps:0,flats:1},Gb:{index:6,sharps:0,flats:6},G:{index:7,sharps:1,flats:0},Ab:{index:8,sharps:0,flats:4},A:{index:9,sharps:3,flats:0},Bb:{index:10,sharps:0,flats:2},B:{index:11,sharps:5,flats:0}};var chordPattern=XRegExp("^(?<chord>[A-G](#|b)?)(?<suffix>(\\(?(M|maj|major|m|min|minor|dim|sus|dom|aug|\\+|-|add)?\\d*\\)?)*)(\\/(?<bass>[A-G](#|b)?))?$");var colours;$(document).ready(function(){colours=themes[0].colours;$("#print-button").click(function(){window.print()});$("#transpose-button").click(function(){transpose($("#chordarea").val())});$('[data-toggle="tooltip"]').tooltip();for(var e=0;e<themes.length;e++){$("#themes").append('<option value="'+e+'">'+themes[e].name+"</option>")}$("#themes").change(function(){colours=themes[Number($("#themes option:selected").val())].colours})})
